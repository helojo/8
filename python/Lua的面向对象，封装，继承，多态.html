<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Lua的面向对象，封装，继承，多态' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Lua的面向对象，封装，继承，多态</center></div><div class='banquan'>原文出处:本文由博客园博主骑鹤下江南提供。<br/>
原文连接:https://www.cnblogs.com/dslx/p/12012118.html</div><br>
    <h3>概述</h3>
<p>　　我们总所周知对象是由属性和方法组成的，要用lua要描述一个对象，也必然要有这两个特性，属性和方法。lua的基本结构是table，所以Lua的类，其实都是table，因为它可以存储普通的变量又可以存储方法，我们利用table就可以描述一个对象的属性和方法。</p>
<h3>对象</h3>
<p>其实lua要模拟一个对象，关键就在于__index设置元表索引这块，它主要起到索引失败后该怎么办，如果它指向一张表，那么__index索引失败后，它会到这张表中去查找有没有你指定的函数或成员值，如果有，__index方法被调用时会返回该函数的返回值。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">--</span><span style="color: #008000;">-</span><span style="color: #008000;">
--</span><span style="color: #008000;">- Generated by EmmyLua(https://github.com/EmmyLua)</span><span style="color: #008000;">
--</span><span style="color: #008000;">- Created by hwc</span><span style="color: #008000;">
--</span><span style="color: #008000;">- DateTime: 2019/12/10 10:14</span><span style="color: #008000;">
--</span><span style="color: #008000;">-</span>
Class =<span style="color: #000000;"> {x,y}
Class.__index </span>=<span style="color: #000000;"> Class
</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> Class:new(x,y)
    </span><span style="color: #0000ff;">local</span> self =<span style="color: #000000;"> {}
    </span><span style="color: #ff00ff;">setmetatable</span><span style="color: #000000;">(self,Class)
    self.x </span>=<span style="color: #000000;"> x
    self.y </span>=<span style="color: #000000;"> y
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> self
</span><span style="color: #0000ff;">end</span>
<span style="color: #0000ff;">function</span><span style="color: #000000;"> Class:getResult()
    </span><span style="color: #0000ff;">return</span> <span style="color: #800080;">0</span>
<span style="color: #0000ff;">end</span></pre>
</div>
<p>这样一个lua的对象就创建完成了。马克思教育我们实践是检验真理的唯一标准，所以我们用lua的写面向对象的思想写一个计算器的demo来看下是怎么实现继承与多态。</p>
<h3>加法</h3>
<p>继承刚才写得Class类，就有了x,y值，可以进行加法运算，以此类推，我们进行减法，乘法，除法的类编写</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">--</span><span style="color: #008000;">-</span><span style="color: #008000;">
--</span><span style="color: #008000;">- Generated by EmmyLua(https://github.com/EmmyLua)</span><span style="color: #008000;">
--</span><span style="color: #008000;">- Created by hwc</span><span style="color: #008000;">
--</span><span style="color: #008000;">- DateTime: 2019/12/10 10:17</span><span style="color: #008000;">
--</span><span style="color: #008000;">-</span>
<span style="color: #ff00ff;">require</span>(<span style="color: #800000;">"</span><span style="color: #800000;">operation.Operation</span><span style="color: #800000;">"</span><span style="color: #000000;">)
AddClass </span>=<span style="color: #000000;"> {}
</span><span style="color: #008000;">--</span><span style="color: #008000;">设置元表为Class</span>
<span style="color: #ff00ff;">setmetatable</span><span style="color: #000000;">(AddClass,Class)
AddClass.__index </span>=<span style="color: #000000;"> AddClass
</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> AddClass:new(x,y)
    </span><span style="color: #0000ff;">local</span> self =<span style="color: #000000;"> {}
    </span><span style="color: #008000;">--</span><span style="color: #008000;">调用父类的构造函数</span>
    self =<span style="color: #000000;"> Class:new(x,y)
    </span><span style="color: #ff00ff;">setmetatable</span><span style="color: #000000;">(self,AddClass)
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> self
</span><span style="color: #0000ff;">end</span>
<span style="color: #008000;">--</span><span style="color: #008000;">重写父类函数</span>
<span style="color: #0000ff;">function</span><span style="color: #000000;"> AddClass:getResult()
    </span><span style="color: #0000ff;">return</span> self.x +<span style="color: #000000;"> self.y
</span><span style="color: #0000ff;">end</span></pre>
</div>
<h3>减法</h3>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">--</span><span style="color: #008000;">-</span><span style="color: #008000;">
--</span><span style="color: #008000;">- Generated by EmmyLua(https://github.com/EmmyLua)</span><span style="color: #008000;">
--</span><span style="color: #008000;">- Created by hwc.</span><span style="color: #008000;">
--</span><span style="color: #008000;">- DateTime: 2019/12/10 10:35</span><span style="color: #008000;">
--</span><span style="color: #008000;">-</span>
<span style="color: #ff00ff;">require</span>(<span style="color: #800000;">"</span><span style="color: #800000;">operation.Operation</span><span style="color: #800000;">"</span><span style="color: #000000;">)
SubClass </span>=<span style="color: #000000;"> {}
</span><span style="color: #ff00ff;">setmetatable</span><span style="color: #000000;">(SubClass,Class)
SubClass.__index </span>=<span style="color: #000000;"> SubClass
</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> SubClass:new(x,y)
    </span><span style="color: #0000ff;">local</span> self =<span style="color: #000000;"> {}
    self </span>=<span style="color: #000000;"> Class:new(x,y)
    </span><span style="color: #ff00ff;">setmetatable</span><span style="color: #000000;">(self,SubClass)
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> self
</span><span style="color: #0000ff;">end</span>
<span style="color: #0000ff;">function</span><span style="color: #000000;"> SubClass:getResult()
    </span><span style="color: #0000ff;">return</span> self.x -<span style="color: #000000;"> self.y
</span><span style="color: #0000ff;">end</span></pre>
</div>
<h3>乘法</h3>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">--</span><span style="color: #008000;">-</span><span style="color: #008000;">
--</span><span style="color: #008000;">- Generated by EmmyLua(https://github.com/EmmyLua)</span><span style="color: #008000;">
--</span><span style="color: #008000;">- Created by hwc.</span><span style="color: #008000;">
--</span><span style="color: #008000;">- DateTime: 2019/12/10 10:39</span><span style="color: #008000;">
--</span><span style="color: #008000;">-</span>
<span style="color: #ff00ff;">require</span>(<span style="color: #800000;">"</span><span style="color: #800000;">operation.Operation</span><span style="color: #800000;">"</span><span style="color: #000000;">)
MulClass </span>=<span style="color: #000000;"> {}
</span><span style="color: #ff00ff;">setmetatable</span><span style="color: #000000;">(MulClass,Class)
MulClass.__index </span>=<span style="color: #000000;"> MulClass
</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> MulClass:new(x,y)
    </span><span style="color: #0000ff;">local</span> self =<span style="color: #000000;"> {}
    self </span>=<span style="color: #000000;"> Class:new(x,y)
    </span><span style="color: #ff00ff;">setmetatable</span><span style="color: #000000;">(self,MulClass)
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> self
</span><span style="color: #0000ff;">end</span>
<span style="color: #0000ff;">function</span><span style="color: #000000;"> MulClass:getResult()
    </span><span style="color: #0000ff;">return</span> self.x *<span style="color: #000000;"> self.y
</span><span style="color: #0000ff;">end</span></pre>
</div>
<h3>除法</h3>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">--</span><span style="color: #008000;">-</span><span style="color: #008000;">
--</span><span style="color: #008000;">- Generated by EmmyLua(https://github.com/EmmyLua)</span><span style="color: #008000;">
--</span><span style="color: #008000;">- Created by hwc.</span><span style="color: #008000;">
--</span><span style="color: #008000;">- DateTime: 2019/12/10 10:42</span><span style="color: #008000;">
--</span><span style="color: #008000;">-</span>
<span style="color: #ff00ff;">require</span>(<span style="color: #800000;">"</span><span style="color: #800000;">operation.Operation</span><span style="color: #800000;">"</span><span style="color: #000000;">)
DivClass </span>=<span style="color: #000000;"> {}
</span><span style="color: #ff00ff;">setmetatable</span><span style="color: #000000;">(DivClass,Class)
DivClass.__index </span>=<span style="color: #000000;"> DivClass
</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> DivClass:new(x,y)
    </span><span style="color: #0000ff;">local</span> self =<span style="color: #000000;"> {}
    self </span>=<span style="color: #000000;"> Class:new(x,y)
    </span><span style="color: #ff00ff;">setmetatable</span><span style="color: #000000;">(self,DivClass)
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> self
</span><span style="color: #0000ff;">end</span>
<span style="color: #0000ff;">function</span><span style="color: #000000;"> DivClass:getResult()
    </span><span style="color: #0000ff;">if</span> self.y == <span style="color: #800080;">0</span> <span style="color: #0000ff;">then</span>
        <span style="color: #ff00ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">除数不能为零</span><span style="color: #800000;">"</span><span style="color: #000000;">)
        </span><span style="color: #0000ff;">return</span> -<span style="color: #800080;">1</span>
    <span style="color: #0000ff;">end</span>
    <span style="color: #0000ff;">return</span> self.x /<span style="color: #000000;"> self.y
</span><span style="color: #0000ff;">end</span></pre>
</div>
<h3>多态</h3>
<p>我们创建一个管理工厂类，管理所有运算。这样一来我们如果要在添加一个开根号或者平方运行，只要在添加根号类和修改工厂的代码，其他就原封不动</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">--</span><span style="color: #008000;">-</span><span style="color: #008000;">
--</span><span style="color: #008000;">- Generated by EmmyLua(https://github.com/EmmyLua)</span><span style="color: #008000;">
--</span><span style="color: #008000;">- Created by hwc.</span><span style="color: #008000;">
--</span><span style="color: #008000;">- DateTime: 2019/12/10 10:46</span><span style="color: #008000;">
--</span><span style="color: #008000;">-</span>
<span style="color: #ff00ff;">require</span>(<span style="color: #800000;">"</span><span style="color: #800000;">operation.OperationAdd</span><span style="color: #800000;">"</span><span style="color: #000000;">)
</span><span style="color: #ff00ff;">require</span>(<span style="color: #800000;">"</span><span style="color: #800000;">operation.OperationSub</span><span style="color: #800000;">"</span><span style="color: #000000;">)
</span><span style="color: #ff00ff;">require</span>(<span style="color: #800000;">"</span><span style="color: #800000;">operation.OperationMul</span><span style="color: #800000;">"</span><span style="color: #000000;">)
</span><span style="color: #ff00ff;">require</span>(<span style="color: #800000;">"</span><span style="color: #800000;">operation.OperationDiv</span><span style="color: #800000;">"</span><span style="color: #000000;">)
FactoryClass </span>=<span style="color: #000000;"> {}
FactoryClass.__index </span>=<span style="color: #000000;"> FactoryClass
</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> FactoryClass:new(x,y,z)
    </span><span style="color: #0000ff;">local</span> self =<span style="color: #000000;"> {}
    </span><span style="color: #ff00ff;">setmetatable</span><span style="color: #000000;">(self,FactoryClass)
    self.x </span>=<span style="color: #000000;"> x
    self.y </span>=<span style="color: #000000;"> y
    self.z </span>=<span style="color: #000000;"> z
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> self
</span><span style="color: #0000ff;">end</span>
<span style="color: #0000ff;">function</span><span style="color: #000000;"> FactoryClass:result()
    </span><span style="color: #0000ff;">local</span> myTable =<span style="color: #000000;"> {}
    </span><span style="color: #0000ff;">if</span> self.z == <span style="color: #800000;">"</span><span style="color: #800000;">+</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">then</span><span style="color: #000000;">
        myTable </span>=<span style="color: #000000;"> AddClass:new(self.x,self.y)
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> myTable
    </span><span style="color: #0000ff;">elseif</span> self.z == <span style="color: #800000;">"</span><span style="color: #800000;">-</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">then</span><span style="color: #000000;">
        myTable </span>=<span style="color: #000000;"> SubClass:new(self.x,self.y)
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> myTable
    </span><span style="color: #0000ff;">elseif</span> self.z == <span style="color: #800000;">"</span><span style="color: #800000;">*</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">then</span><span style="color: #000000;">
        myTable </span>=<span style="color: #000000;"> MulClass:new(self.x,self.y)
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> myTable
    </span><span style="color: #0000ff;">elseif</span> self.z == <span style="color: #800000;">"</span><span style="color: #800000;">/</span><span style="color: #800000;">"</span> <span style="color: #0000ff;">then</span><span style="color: #000000;">
        myTable </span>=<span style="color: #000000;"> DivClass:new(self.x,self.y)
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> myTable
    </span><span style="color: #0000ff;">end</span>
<span style="color: #0000ff;">end</span></pre>
</div>
<p>添加一个Main类运行</p>
<p><img src="./images/Lua的面向对象，封装，继承，多态0.png" alt="" /></p>
<p>&nbsp;</p>
<h3>&nbsp;总结</h3>
<p>　　一个利用面向对象思想的lua简单计算器就完成了，我们宰Lua中模拟了类，继承，和多态的特征，起到了可复用，可扩展，解耦的特性，为lua开发web项目带来了极大的便利</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>