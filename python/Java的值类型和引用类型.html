<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Java的值类型和引用类型' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Java的值类型和引用类型</center></div><div class='banquan'>原文出处:本文由博客园博主Turtle_Zhang提供。<br/>
原文连接:https://www.cnblogs.com/zhh19981104/p/12036420.html</div><br>
    <h1>一、问题描述</h1>
<p>　　前几天因为一个需求出现了Bug。说高级点也挺高级，说白点也很简单。其实也就是一个很简单的Java基础入门时候的值类型和引用类型的区别。只是开发的时候由于自己的问题，导致小问题的出现。还好突然想起来以前看过一篇对于该问题讲解的博客，才能快速定位问题的位置。防止下次再犯，顺便也就把这个当做笔记记录下来，放入自己的Bug集中。</p>
<h1>二、值类型和引用类型的比较</h1>
<p>　　这个大家应该都是没问题的，很简单。值类型比较是比较值，引用类型是比较地址。对于正常的操作来说，比较值类型我们可以直接使用 == ，引用类型就使用equals来做比较就不会出现问题。</p>
<h2>引用类型&nbsp;</h2>
<div class="cnblogs_code">
<pre><code><span style="font-size: 16px;"><span style="color: #008080;">1</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">2</span> <span style="color: #008000;">     * 测试Integer
</span><span style="color: #008080;">3</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">4</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> test_Integer(){
</span><span style="color: #008080;">5</span>         Integer number_01 = 10<span style="color: #000000;">;
</span><span style="color: #008080;">6</span>         Integer number_02 = 10<span style="color: #000000;">;
</span><span style="color: #008080;">7</span> <span style="color: #000000;">        System.out.println(number_01.equals(number_02));
</span><span style="color: #008080;">8</span>     }</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-size: 14pt;">上面的测试结果很明显是true，绝对没有问题的。</span></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<img src="./images/Java的值类型和引用类型0.png" alt="" /></p>
<p>&nbsp;</p>
<h2>值类型</h2>
<div class="cnblogs_code">
<pre><code><span style="font-size: 16px;"><span style="color: #008080;">1</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">2</span> <span style="color: #008000;">     * 测试int
</span><span style="color: #008080;">3</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">4</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> test_Int(){
</span><span style="color: #008080;">5</span>         <span style="color: #0000ff;">int</span> number_01 = 10<span style="color: #000000;">;
</span><span style="color: #008080;">6</span>         <span style="color: #0000ff;">int</span> number_02 = 10<span style="color: #000000;">;
</span><span style="color: #008080;">7</span>         System.out.println(number_01 ==<span style="color: #000000;"> number_02);
</span><span style="color: #008080;">8</span>     }</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-size: 14pt;">上面的测试结果很明显是true，绝对没有问题的。</span></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<img src="./images/Java的值类型和引用类型1.png" alt="" /></p>
<h1>三、问题</h1>
<p><span style="font-size: 18px;">但是问题就出现在，开发的使用为了防止出现为null的时候会被系统使用0来代替，所以就使用了Integer类型来做操作，并且在比较的时候用了 == 。这就很尴尬了，开始自测完全没出现问题，因为没到达记录数。很开心，把代码提交下班，妥妥的。但是尴尬的事情来了，测试报告出现在了邮箱里面了。</span></p>
<h2>初始没问题的情况</h2>
<div class="cnblogs_code">
<pre><code><span style="font-size: 16px;"><span style="color: #008080;">1</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">2</span> <span style="color: #008000;">     * 测试Integer
</span><span style="color: #008080;">3</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">4</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> test_Integer(){
</span><span style="color: #008080;">5</span>         Integer number_001 = 10<span style="color: #000000;">;
</span><span style="color: #008080;">6</span>         Integer number_002 = 10<span style="color: #000000;">;
</span><span style="color: #008080;">7</span>         System.out.println(number_001 ==<span style="color: #000000;"> number_002);
</span><span style="color: #008080;">8</span>     }</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-size: 18px;">结果：</span></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <img src="./images/Java的值类型和引用类型2.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>当记录超过一定数的时候，出现问题</h2>
<div class="cnblogs_code">
<pre><code><span style="font-size: 16px;"><span style="color: #008080;">1</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">2</span> <span style="color: #008000;">     * 测试Integer
</span><span style="color: #008080;">3</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">4</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> test_Integer(){
</span><span style="color: #008080;">5</span>         Integer number_001 = 128<span style="color: #000000;">;
</span><span style="color: #008080;">6</span>         Integer number_002 = 128<span style="color: #000000;">;
</span><span style="color: #008080;">7</span>         System.out.println(number_001 ==<span style="color: #000000;"> number_002);
</span><span style="color: #008080;">8</span>     }</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-size: 18px;">结果：</span></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<img src="./images/Java的值类型和引用类型3.png" alt="" /></p>
<h1>四、解决</h1>
<p><span style="font-size: 18px;">后面一想，很快确定问题了。是自己的马虎，偷懒使用了 == ，造成这次问题的出现，当改为equals就可以妥妥的回家了。开始自测没问题主要还是因为Integer 的缓存搞的事情。扒拉到Integer的源码，发现里面用了缓存机制，对-128~127的值做了缓存，如果在这个值区间内使用==来做比较的话，比较的就是值了，所以才造成开始以为没问题，后面运行了一段时间后就出现问题了。当不在值区间内就必须使用equals来完成比较。</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 16px;"><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> IntegerCache {
</span><span style="color: #008080;"> 2</span>         <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">int</span> low = -128<span style="color: #000000;">;
</span><span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> high;
</span><span style="color: #008080;"> 4</span>         <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span><span style="color: #000000;"> Integer cache[];
</span><span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">static</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 7</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> high value may be configured by property</span>
<span style="color: #008080;"> 8</span>             <span style="color: #0000ff;">int</span> h = 127<span style="color: #000000;">;
</span><span style="color: #008080;"> 9</span>             String integerCacheHighPropValue =
<span style="color: #008080;">10</span>                 sun.misc.VM.getSavedProperty("java.lang.Integer.IntegerCache.high"<span style="color: #000000;">);
</span><span style="color: #008080;">11</span>             <span style="color: #0000ff;">if</span> (integerCacheHighPropValue != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">12</span>                 <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">13</span>                     <span style="color: #0000ff;">int</span> i =<span style="color: #000000;"> parseInt(integerCacheHighPropValue);
</span><span style="color: #008080;">14</span>                     i = Math.max(i, 127<span style="color: #000000;">);
</span><span style="color: #008080;">15</span>                     <span style="color: #008000;">//</span><span style="color: #008000;"> Maximum array size is Integer.MAX_VALUE</span>
<span style="color: #008080;">16</span>                     h = Math.min(i, Integer.MAX_VALUE - (-low) -1<span style="color: #000000;">);
</span><span style="color: #008080;">17</span>                 } <span style="color: #0000ff;">catch</span><span style="color: #000000;">( NumberFormatException nfe) {
</span><span style="color: #008080;">18</span>                     <span style="color: #008000;">//</span><span style="color: #008000;"> If the property cannot be parsed into an int, ignore it.</span>
<span style="color: #008080;">19</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">20</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">21</span>             high =<span style="color: #000000;"> h;
</span><span style="color: #008080;">22</span> 
<span style="color: #008080;">23</span>             cache = <span style="color: #0000ff;">new</span> Integer[(high - low) + 1<span style="color: #000000;">];
</span><span style="color: #008080;">24</span>             <span style="color: #0000ff;">int</span> j =<span style="color: #000000;"> low;
</span><span style="color: #008080;">25</span>             <span style="color: #0000ff;">for</span>(<span style="color: #0000ff;">int</span> k = 0; k &lt; cache.length; k++<span style="color: #000000;">)
</span><span style="color: #008080;">26</span>                 cache[k] = <span style="color: #0000ff;">new</span> Integer(j++<span style="color: #000000;">);
</span><span style="color: #008080;">27</span> 
<span style="color: #008080;">28</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> range [-128, 127] must be interned (JLS7 5.1.7)</span>
<span style="color: #008080;">29</span>             <span style="color: #0000ff;">assert</span> IntegerCache.high &gt;= 127<span style="color: #000000;">;
</span><span style="color: #008080;">30</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">31</span> 
<span style="color: #008080;">32</span>         <span style="color: #0000ff;">private</span><span style="color: #000000;"> IntegerCache() {}
</span><span style="color: #008080;">33</span>     }</span></pre>
</div>
<p>&nbsp;</p>
<h1>五、总结</h1>
<p><span style="font-size: 18px;">当初面试的时候这种东西应该是背的滚瓜烂熟，绝对可以应对面试。但是一旦开发起来就是各种问题都出现了，而且这种东西还不会报出错日志，纯属开发问题。归总来说还是自己的水平不够，还需要继续提高。下次要防止这种低级问题的出现，很尴尬。同样也是对自己学的东西要融汇贯通，而不是每学一个单独的知识点就够了，没有起到联通的效果。源码扒拉一下还是会加深自己的印象。</span></p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>