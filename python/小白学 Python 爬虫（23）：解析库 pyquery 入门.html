<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修小白学 Python 爬虫（23）：解析库 pyquery 入门' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>小白学 Python 爬虫（23）：解析库 pyquery 入门</center></div><div class='banquan'>原文出处:本文由博客园博主极客挖掘机提供。<br/>
原文连接:https://www.cnblogs.com/babycomeon/p/12071342.html</div><br>
    <p><img src="./images/小白学 Python 爬虫（23）：解析库 pyquery 入门0.png" /></p>
<blockquote>
<p>人生苦短，我用 Python</p>
</blockquote>
<p>前文传送门：</p>
<p><a href="https://www.geekdigging.com/2019/11/13/3303836941/">小白学 Python 爬虫（1）：开篇</a></p>
<p><a href="https://www.geekdigging.com/2019/11/20/2586166930/">小白学 Python 爬虫（2）：前置准备（一）基本类库的安装</a></p>
<p><a href="https://www.geekdigging.com/2019/11/21/1005563697/">小白学 Python 爬虫（3）：前置准备（二）Linux基础入门</a></p>
<p><a href="https://www.geekdigging.com/2019/11/22/3679472340/">小白学 Python 爬虫（4）：前置准备（三）Docker基础入门</a></p>
<p><a href="https://www.geekdigging.com/2019/11/24/334078215/">小白学 Python 爬虫（5）：前置准备（四）数据库基础</a></p>
<p><a href="https://www.geekdigging.com/2019/11/25/1881661601/">小白学 Python 爬虫（6）：前置准备（五）爬虫框架的安装</a></p>
<p><a href="https://www.geekdigging.com/2019/11/26/1197821400/">小白学 Python 爬虫（7）：HTTP 基础</a></p>
<p><a href="https://www.geekdigging.com/2019/11/27/101847406/">小白学 Python 爬虫（8）：网页基础</a></p>
<p><a href="https://www.geekdigging.com/2019/11/28/1668465912/">小白学 Python 爬虫（9）：爬虫基础</a></p>
<p><a href="https://www.geekdigging.com/2019/12/01/2475257648/">小白学 Python 爬虫（10）：Session 和 Cookies</a></p>
<p><a href="https://www.geekdigging.com/2019/12/02/2333822325/">小白学 Python 爬虫（11）：urllib 基础使用（一）</a></p>
<p><a href="https://www.geekdigging.com/2019/12/03/819896244/">小白学 Python 爬虫（12）：urllib 基础使用（二）</a></p>
<p><a href="https://www.geekdigging.com/2019/12/04/2992515886/">小白学 Python 爬虫（13）：urllib 基础使用（三）</a></p>
<p><a href="https://www.geekdigging.com/2019/12/05/104488944/">小白学 Python 爬虫（14）：urllib 基础使用（四）</a></p>
<p><a href="https://www.geekdigging.com/2019/12/07/2788855167/">小白学 Python 爬虫（15）：urllib 基础使用（五）</a></p>
<p><a href="https://www.geekdigging.com/2019/12/09/1691033431/">小白学 Python 爬虫（16）：urllib 实战之爬取妹子图</a></p>
<p><a href="https://www.geekdigging.com/2019/12/10/1910005577/">小白学 Python 爬虫（17）：Requests 基础使用</a></p>
<p><a href="https://www.geekdigging.com/2019/12/11/1468953802/">小白学 Python 爬虫（18）：Requests 进阶操作</a></p>
<p><a href="https://www.geekdigging.com/2019/12/12/3568648672/">小白学 Python 爬虫（19）：Xpath 基操</a></p>
<p><a href="https://www.geekdigging.com/2019/12/13/2569867940/">小白学 Python 爬虫（20）：Xpath 进阶</a></p>
<p><a href="https://www.geekdigging.com/2019/12/15/2789385418/">小白学 Python 爬虫（21）：解析库 Beautiful Soup（上）</a></p>
<p><a href="https://www.geekdigging.com/2019/12/16/876770087/">小白学 Python 爬虫（22）：解析库 Beautiful Soup（下）</a></p>
<h2 id="引言">引言</h2>
<p>前面一篇我们介绍了 Beautiful Soup 中可以使用 CSS 选择器，但是好像他的 CSS 选择器并没有想像中的强大。</p>
<p>本篇就介绍一个对 CSS 选择器更加友好的类库 —— <code>pyquery</code> 。它在语法上更加贴和 JQuery ，估计会成为各位后端开发人员的福音。</p>
<p>首先，还是先敬上各种官方地址：</p>
<p>官方文档：<a href="https://pyquery.readthedocs.io/en/latest/" class="uri">https://pyquery.readthedocs.io/en/latest/</a></p>
<p>PyPI：<a href="https://pypi.org/project/pyquery/" class="uri">https://pypi.org/project/pyquery/</a></p>
<p>Github：<a href="https://github.com/gawel/pyquery" class="uri">https://github.com/gawel/pyquery</a></p>
<p>有问题，找官方，这句话是肯定不会错滴~~</p>
<h2 id="初始化">初始化</h2>
<p>首先，各位同学需要确保已经安装过 <code>pyquery</code> ，没有安装过的朋友可以翻一翻前面的前置准备，小编已经介绍过安装方式。</p>
<p>先来看一个简单的初始化的示例（还是使用上一篇的 HTML ，懒人真的没救了）：</p>
<pre><code><code>from pyquery import PyQuery

html = &#39;&#39;&#39;
&lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse&#39;s story&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt;

&lt;p class=&quot;story&quot;&gt;Once upon a time there were three little sisters; and their names were
&lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
&lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and
&lt;a href=&quot;http://example.com/tillie&quot; class=&quot;sister&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;;
and they lived at the bottom of a well.&lt;/p&gt;

&lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;
&#39;&#39;&#39;

d = PyQuery(html)
print(d(&#39;p&#39;))</code></pre>
<p>结果如下：</p>
<pre><code><code>&lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt;

&lt;p class=&quot;story&quot;&gt;Once upon a time there were three little sisters; and their names were
&lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
&lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and
&lt;a href=&quot;http://example.com/tillie&quot; class=&quot;sister&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;;
and they lived at the bottom of a well.&lt;/p&gt;

&lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;</code></pre>
<p>以上是直接使用字符串进行的初始化，同时它还支持直接传入 URL 地址进行初始化：</p>
<pre><code><code>d_url = PyQuery(url=&#39;https://www.geekdigging.com/&#39;, encoding=&#39;UTF-8&#39;)
print(d_url(&#39;title&#39;))</code></pre>
<p>结果如下：</p>
<pre><code><code>&lt;title&gt;极客挖掘机&lt;/title&gt;</code></pre>
<p>这样写的话，其实 <code>PyQuery</code> 会先请求这个 URL ，然后用响应得到的 HTML 内容完成初始化，与下面这样写其实也是一样的：</p>
<pre><code><code>r = requests.get(&#39;https://www.geekdigging.com/&#39;)
r.encoding = &#39;UTF-8&#39;
d_requests = PyQuery(r.text)
print(d_requests(&#39;title&#39;))</code></pre>
<h2 id="css-选择器">CSS 选择器</h2>
<p>我们先来简单感受下 CSS 选择器的用法，真的是非常的简单方便：</p>
<pre><code><code>d_css = PyQuery(html)
print(d_css(&#39;.story .sister&#39;))
print(type(d_css(&#39;.story .sister&#39;)))</code></pre>
<p>结果如下：</p>
<pre><code><code>&lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
&lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and
&lt;a href=&quot;http://example.com/tillie&quot; class=&quot;sister&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;;
and they lived at the bottom of a well.
&lt;class &#39;pyquery.pyquery.PyQuery&#39;&gt;</code></pre>
<p>这里的写法含义是我们先寻找 class 为 story 的节点，寻找到以后接着在它的子节点中继续寻找 class 为 sister 的节点。</p>
<p>最后的打印结果中可以看到，它的类型依然为 <code>pyquery.pyquery.PyQuery</code> ，说明我们可以继续使用这个结果解析。</p>
<h2 id="查找节点">查找节点</h2>
<p>我们接着介绍一下常用的查找函数，这些查找函数最赞的地方就是它们和 JQuery 的用法完全一致。</p>
<ul>
<li>find() ： 查找节点的所有子孙节点。</li>
<li>children() ： 只查找子节点。</li>
<li>parent() ： 查找父节点。</li>
<li>parents() ： 查找祖先节点。</li>
<li>siblings() ： 查找兄弟节点。</li>
</ul>
<p>下面来一些简单的示例：</p>
<pre><code><code># 查找子节点
items = d(&#39;body&#39;)
print(&#39;子节点：&#39;, items.find(&#39;p&#39;))
print(type(items.find(&#39;p&#39;)))

# 查找父节点
items = d(&#39;#link1&#39;)
print(&#39;父节点：&#39;, items.parent())
print(type(items.parent()))

# 查找兄弟节点
items = d(&#39;#link1&#39;)
print(&#39;兄弟节点：&#39;, items.siblings())
print(type(items.siblings()))</code></pre>
<p>结果如下：</p>
<pre><code><code>子节点： &lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt;

&lt;p class=&quot;story&quot;&gt;Once upon a time there were three little sisters; and their names were
&lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
&lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and
&lt;a href=&quot;http://example.com/tillie&quot; class=&quot;sister&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;;
and they lived at the bottom of a well.&lt;/p&gt;

&lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;

&lt;class &#39;pyquery.pyquery.PyQuery&#39;&gt;
父节点： &lt;p class=&quot;story&quot;&gt;Once upon a time there were three little sisters; and their names were
&lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
&lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and
&lt;a href=&quot;http://example.com/tillie&quot; class=&quot;sister&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;;
and they lived at the bottom of a well.&lt;/p&gt;


&lt;class &#39;pyquery.pyquery.PyQuery&#39;&gt;
兄弟节点： &lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and
&lt;a href=&quot;http://example.com/tillie&quot; class=&quot;sister&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;;
and they lived at the bottom of a well.
&lt;class &#39;pyquery.pyquery.PyQuery&#39;&gt;</code></pre>
<h2 id="遍历">遍历</h2>
<p>通过上面的示例，可以看到，如果 pyquery 取出来的有多个节点，虽然类型也是 <code>PyQuery</code> ，但是和 Beautiful Soup 不一样的是返回的并不是列表，如果我们需要继续获取其中的节点，就需要遍历这个结果，可以使用 <code>items()</code> 这个获取结果进行遍历：</p>
<pre><code><code>a = d(&#39;a&#39;)
for item in a.items():
    print(item)</code></pre>
<p>结果如下：</p>
<pre><code><code>&lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,

&lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and

&lt;a href=&quot;http://example.com/tillie&quot; class=&quot;sister&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;;
and they lived at the bottom of a well.</code></pre>
<p>这里我们调用 <code>items()</code> 后，会返回一个生成器，遍历一下，就可以逐个得到 a 节点对象了，它的类型也是 PyQuery 类型。每个 a 节点还可以调用前面所说的方法进行选择，比如继续查询子节点，寻找某个祖先节点等，非常灵活。</p>
<h2 id="提取信息">提取信息</h2>
<p>前面我们获取到节点以后，接着就是要获取我们所需要的信息了。</p>
<p>获取信息主要分为两个部分，一个是获取节点的文本信息，一个获取节点的属性信息。</p>
<h3 id="获取文本信息">获取文本信息</h3>
<pre><code><code>a_1 = d(&#39;#link1&#39;)
print(a_1.text())</code></pre>
<p>结果如下：</p>
<pre><code><code>Elsie</code></pre>
<p>如果想获取这个节点内的 HTML 信息，可以使用 <code>html()</code> 方法：</p>
<pre><code><code>a_2 = d(&#39;.story&#39;)
print(a_2.html())</code></pre>
<p>结果如下：</p>
<pre><code><code>Once upon a time there were three little sisters; and their names were
&lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
&lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and
&lt;a href=&quot;http://example.com/tillie&quot; class=&quot;sister&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;;
and they lived at the bottom of a well.</code></pre>
<h3 id="获取属性信息">获取属性信息</h3>
<p>当我们获取到节点以后，可以使用 <code>attr()</code> 来获取相关的属性信息：</p>
<pre><code><code>attr_1 = d(&#39;#link1&#39;)
print(attr_1.attr(&#39;href&#39;))</code></pre>
<p>结果如下：</p>
<pre><code><code>http://example.com/elsie</code></pre>
<p>除了我们可以使用 <code>attr()</code> 这个方法以外， pyquery 还为我们提供了 <code>attr</code> 属性，比如上面的示例还可以写成这样：</p>
<pre><code><code>print(attr_1.attr.href)</code></pre>
<p>结果和上面的示例是一样的。</p>
<h2 id="小结">小结</h2>
<p>我们在前置准备中安装的几种解析器到此就介绍完了，综合比较一下，Beautiful Soup 对新手比较友好，无需了解更多的其他知识就可以上手使用，但是对于复杂 DOM 的解析，依然需要一定的 CSS 选择器的基础，如果对 Xpath 比较熟练的话直接使用 lxml 倒是最为方便的，如果和小编一样，对 JQuery 和 CSS 选择器都比较熟悉，那么 pyquery 倒是一个很不错的选择。</p>
<p>接下来小编计划做几个简单的实战分享，敬请期待哦~~~</p>
<h2 id="示例代码">示例代码</h2>
<p>本系列的所有代码小编都会放在代码管理仓库 Github 和 Gitee 上，方便大家取用。</p>
<p><a href="https://github.com/meteor1993/python-learning/tree/master/python-spider/pyquery-demo" title="示例代码-Github">示例代码-Github</a></p>
<p><a href="https://gitee.com/inwsy/python-learning/tree/master/python-spider/pyquery-demo" title="示例代码-Gitee">示例代码-Gitee</a></p>

</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>